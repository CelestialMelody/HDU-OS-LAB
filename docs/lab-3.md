# å®éªŒ3

### å®ç°ä¸€ä¸ªæ¨¡æ‹Ÿçš„shell

[æŸ¥çœ‹ä»£ç ](../lab3/shell)

(ps: å¦å¤–æä¾›äº†ä¸€ä¸ª rust å®ç°çš„ shell, è¿™æ˜¯ [fs-rs æä¾›çš„ shell](https://github.com/CelestialMelody/fs-rs/blob/main/src/main.rs) çš„å‚è€ƒå®ç°)

**å®éªŒæ€è·¯**

å¯ä»¥ä½¿ç”¨ç°æœ‰çš„Cè¯­è¨€å‡½æ•°æ¥å®ç°shellå‘½ä»¤

> å‚è€ƒ: [execæ—å‡½æ•° systemå‡½æ•° popenå‡½æ•° PATH](https://blog.csdn.net/FHNCSDN/article/details/118328231)





### å®ç°ä¸€ä¸ªç®¡é“é€šä¿¡ç¨‹åº

[æŸ¥çœ‹ä»£ç ](../lab3/pipe)

**æ— åç®¡é“**

éœ€è¦æŒ‡å®šä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦, é€šè¿‡ `pipe` å‡½æ•°åˆ›å»ºä¸€ä¸ªç®¡é“æ–‡ä»¶ä½¿å…¶ä¸€ç«¯è¯»æ–‡ä»¶ä¸€ç«¯å†™

å¯¹ç®¡é“æ–‡ä»¶çš„è¯»å†™å’Œæ™®é€šæ–‡ä»¶ä¸€æ ·, ç›´æ¥ç”¨ `read` å’Œ `write` å‡½æ•°

è¯»å†™ä¹‹å‰è¦è°ƒç”¨ `close` å…³é—­ä¸éœ€è¦çš„å†™è¯»æè¿°ç¬¦

```c
int fd[2];
pipe(fd); // fd[0]è¯»æ–‡ä»¶, fd[1]å†™æ–‡ä»¶
```

åˆ©ç”¨ä¿¡å·é‡æœºåˆ¶, è®©å­è¿›ç¨‹å…ˆå‘é€æ¶ˆæ¯, æœ€åçˆ¶è¿›ç¨‹æ¥å—ä¿¡æ¯

[æŸ¥çœ‹ä»£ç ](../lab3/pipe/pipe.c)



**æœ‰åç®¡é“**

æœ‰åç®¡é“ä½¿ç”¨çš„æ˜¯ `fifo` å‡½æ•°, ä¸€ä¸ªè¿›ç¨‹å†™æ•°æ®, ä¸€ä¸ªè¿›ç¨‹è¯»æ•°æ®

å¯¹ç®¡é“æ–‡ä»¶çš„è¯»å†™å’Œæ™®é€šæ–‡ä»¶ä¸€æ ·, ç›´æ¥ç”¨ open, write, å’Œ read å‡½æ•°

```c
int mkfifo(const char * pathname, mode_t mode); // pathnameä¸ºç®¡é“æ–‡ä»¶æ‰€åœ¨åœ°å€ï¼Œmodeä¸ºç®¡é“æ–‡ä»¶æƒé™
```

1. å¯ä»¥ä½¿ç”¨ fork å®ç°(ä¸‰ä¸ªå­è¿›ç¨‹ä¸ä¸€ä¸ªçˆ¶è¿›ç¨‹) [æŸ¥çœ‹ä»£ç ](../lab3/pipe/fifopipe.c)

2. åˆ†å‡ºè¯»å†™æœ‰åç®¡é“(ä¸€ä¸ªè¿›ç¨‹è¯», ä¸€ä¸ªè¿›ç¨‹å†™) [è¯»è¿›ç¨‹](../lab3/pipe/fifo_read.c) [å†™è¿›ç¨‹](../lab3/pipe/fifo_write.c) 

   åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹, ä¸€æ–¹å‘é€, ä¸€æ–¹æ¥æ”¶, ç›´è¾¾å‘é€æ”¾å‘é€ "exit" 

> ä½¿ç”¨å‰, å¦‚æœä¹‹å‰çš„æœ‰åç®¡é“å­˜åœ¨, å…ˆæ¸…ç†æœ‰åç®¡é“ (rm fifoname)
>
> å¦‚æœä½¿ç”¨ Ctrl + c/z/d å¼ºåˆ¶é€€å‡º, è®°å¾—å…ˆæ¸…ç†æœ‰åç®¡é“ (rm fifoname)
>
> å¦å¤–, æœ€åéœ€è¦çš„æ•ˆæœçœ‹æƒ…å†µè°ƒæ•´, å®ç°åŒ…æ‹¬:
>
> - ä¸€ç›´è¯»å–æ•°æ®ç›´åˆ°è¾“å…¥ quit æˆ–è€… exit
> - è¯»å–æŒ‡å®šçš„å­—èŠ‚æ•° ç›´åˆ°ç®¡é“ä¸ºç©º



**ç»Ÿè®¡æ— åç®¡é“å¤§å°**

è®©ä¸€ä¸ªçº¿ç¨‹ä¸æ–­å¾€æ— åç®¡é“ä¸­å†™å…¥æ•°æ®, ç›´è‡³ç®¡é“å†™æ»¡åé˜»å¡

å¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…è‹¥å¹²æ—¶é—´å(æ­¤æ—¶ç®¡é“å·²å†™æ»¡), è¾“å‡ºç®¡é“å†™å…¥æ•°æ®å¤§å°

[æŸ¥çœ‹ä»£ç ](../lab3/pipe/size_of_pipe.c)



### åˆ©ç”¨Linuxçš„æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡æœºåˆ¶å®ç°ä¸¤ä¸ªçº¿ç¨‹é—´çš„é€šä¿¡

åŒ…æ‹¬å¤šè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åŒæ­¥ã€äº’æ–¥é€šä¿¡

sender1, sender2 ç»™ reciver å‘æ¶ˆæ¯; å½“ sender å‘é€ "exit" æ—¶è‡ªå·±é€€å‡º; å½“ reciver æ”¶åˆ° sender1, sender2 ä¸¤è€…çš„ "exit" æ—¶é€€å‡º

> ä»£ç åˆ†åˆ«æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹
>
> _thread: ä½¿ç”¨çº¿ç¨‹å®ç°, å®é™…æ•ˆæœä¸å¥½(ä»…ä¾›å‚è€ƒ)
>
> _fifo: å€ŸåŠ© fifo å®ç°(å‚è€ƒå­¦é•¿ä»£ç ä¿®æ”¹ç‰ˆ, è™½ç„¶ä»£ç ç¡®å®æ˜¯ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—, ä½†ä»ç„¶å€ŸåŠ©äº†æœ‰åç®¡é“å®ç°)
>
> procee_mq: ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶å®ç°

[æŸ¥çœ‹ä»£ç ](../lab3/mq) [æ¨èä½¿ç”¨](../lab3/mq/process_mq)



### åˆ©ç”¨Linuxçš„å…±äº«å†…å­˜é€šä¿¡æœºåˆ¶å®ç°ä¸¤ä¸ªè¿›ç¨‹é—´çš„é€šä¿¡

å®ç°åŒå‘é€šä¿¡

å½“å‰å®ç°ä¸­ä½¿ç”¨ 3 ä¸ªä¿¡å·é‡: send, recv1, recv2

å‡è®¾ user1 è·å– send, å½“ user1 å‘é€å®Œæˆå, signal(recv2), é€šçŸ¥ user2 å¯ä»¥å‘é€ä¸æ¥æ”¶;

å½“ user2 è·å–åˆ° recv2, è¯»å–åå†…å®¹å, signal(send), äºæ˜¯ user1 ä¸ user2 å¯ä»¥ä»»æ„ä¸€æ–¹è·å– send å‘é€;

ç›´åˆ°ä¸€æ–¹å‘é€ "over"

[æŸ¥çœ‹ä»£ç ](../lab3/shm)





**ğŸ¡è¯´æ˜**

*æœ¬å®éªŒä¸»è¦å‚è€ƒäº†å­¦é•¿ä»£ç  [github](https://github.com/plussone/HDU-operation-system-course-design-code) æˆ‘è¿›è¡Œäº†å‚è€ƒ, å­¦ä¹ , ä¿®æ”¹*

*å¦å¤–, å­¦é•¿ä¹ŸåŸºæœ¬å¯¹æ•´ä¸ªæ“ä½œç³»ç»Ÿå®éªŒè¿›è¡Œäº†è¯¦ç»†çš„åˆ†äº« [åœ°å€](https://blog.csdn.net/qq_34851605/category_10779696.html)*

*æœ¬ç« å†…å®¹ä¹Ÿæ˜¯å‚è€ƒäº†å­¦é•¿çš„åˆ†äº« éå¸¸æ„Ÿè°¢å­¦é•¿çš„åˆ†äº«â¤ï¸*





*å…¶ä»–å‚è€ƒèµ„æ–™*

> [exec æ—](https://book.itheima.net/course/223/1277519158031949826/1277528003525484545)
>
> *è¿›ç¨‹é—´é€šä¿¡*
>
> - [åŒ¿åç®¡é“](https://book.itheima.net/course/223/1277519158031949826/1277528240394608641)
> - [æœ‰åç®¡é“](https://book.itheima.net/course/223/1277519158031949826/1277528240402997249)
>
> - [æ¶ˆæ¯é˜Ÿåˆ—](https://book.itheima.net/course/223/1277519158031949826/1277528201857343489)
> - [å…±äº«å†…å­˜](https://book.itheima.net/course/223/1277519158031949826/1277528201861537793)
>
> *çº¿ç¨‹åŒæ­¥*
>
> - [ä¿¡å·é‡](https://book.itheima.net/course/223/1277519158031949826/1277528625427521540)